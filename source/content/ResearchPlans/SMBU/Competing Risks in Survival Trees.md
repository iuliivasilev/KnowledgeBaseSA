План исследования:
1. Введение
- Актуальность анализа выживаемости с конкурирующими рисками.
- Роль деревьев выживания в современных методах прогнозирования.
- Краткий обзор классического log-rank критерия и его адаптаций для конкурирующих рисков.
- Постановка задачи: исследование эффективности использования двух видов log-rank критериев в построении survival trees.

2. Обзор литературы
- Краткий обзор методов анализа конкурирующих рисков.
- Существующие методы построения деревьев выживания: классические и с конкурирующими рисками.    
- Анализ существующих подходов к критериям разбиения: векторный log-rank (раздельные статистики по рискам) и агрегированный тест.
    
3. Методология
- Формализация классического log-rank критерия для конкурирующих рисков (векторный подход).
- Формализация агрегированного log-rank критерия с взвешиванием по рискам.
- Интеграция этих критериев в алгоритм построения деревьев выживания:
    - как вычисляется статистика на каждом сплите,
    - критерии выбора разбиения,
    - Листовая модель - AJ (прогноз набора функций выживания).
- Описание алгоритма построения survival tree с обоими критериями.
    
4. Экспериментальное исследование
- Описание наборов данных (модельные синтетические и реальные клинические данные с конкурирующими рисками).
- Метрики качества моделей: Concordance index, Integrated Brier Score, устойчивость и интерпретируемость.
- Экспериментальное сравнение двух версий деревьев:
    - Дерево с векторным log-rank критерием (максимальный компонент статистики).
    - Дерево с агрегированным log-rank критерием (взвешенная сумма статистик).
- Анализ результатов: статистическая значимость, преимущества и ограничения каждого подхода.
    
5. Обсуждение (или в пункт 4)
- Интерпретация полученных результатов с точки зрения чувствительности к различным типам рисков.
- Возможные применения и ограничения каждого из критериев.
- Влияние выбора критерия на interpretability и сложность моделей.

6. Заключение
- Краткое резюме основных выводов.
- Перспективы развития: интеграция с ML методами, адаптивные весовые схемы, применение в онлайн анализе.

7. Приложения (по необходимости)
- Описание алгоритмических деталей реализации.
- Псевдокод для построения деревьев с обоими критериями.
- Данные и скрипты экспериментов.

## Векторное представление статистик по каждому риску
- Рассчитывается отдельная статистика log-rank Uk для каждого конкурирующего риска k=1,…,K по формуле (OvR терминальное событие):
    ![[Pasted image 20250829153559.png]]
    
- где:
	- Ykj — оставшееся число событий типа k к моменту tj,
	- dj=∑k dkj — общее число наступивших событий всех типов в момент tj,
	- dkj — фактическое число событий риска k в момент tj,
	- Ykj/Yj * dj — ожидаемое число событий риска k при условии, что распределение событий в группах одинаковое.
- Вектор U=(U1,U2,…,UK) позволяет оценить различия по каждому типу события.
- Удобно, когда нужно понять, при каком риске группы отличаются (и анализировать причины различий).
- Выбор разбиения: max_f max_fi max_k U_k(S1={f < fk}, S2={f >= fk})
- В каждом разбиении выбираем только один максимизируемый риск.
- Важна интерпретация (какие риски позволили лучше разбивать выборки) по готовому дереву
## Агрегированный критерий
- Считаем взвешенную сумму по вектору LR_k:
  ![[Pasted image 20250829154111.png]]    
- Веса заданы пользователем или пропорция из исходной выборки (или выбрать)
- Построение дерева более гладко, с учетом общих изменений в выборке (если какой-то тип событий влияет сильнее).