
План работы: (интерпретируемое моделирование повторных госпитализаций с динамическими признаками и маргинальными/условными рисками)

1. Введение и постановка проблемы
- **Контекст.** Повторные госпитализации создают нагрузку на стационары и бюджеты; корректная оценка времени до очередного визита и факторов риска позволяет точнее планировать ресурсы и профилактику.
- **Пробел.** В практике часто используют бинарное «readmitted: yes/no за 30 дней», теряя информацию о _времени_ и _многократности_ событий.
- **Цель.** Построить модели _recurrent events_ (повторных событий), оценивающие _время до следующей госпитализации_ с учётом порядка событий и динамических ковариат.

2. Новизна:
	1. **Сравнение семейств моделей** для повторяющихся событий:
		- **Модели типа “counting process” (process-based):**
		    - **Andersen–Gill (AG) model** — расширение Cox proportional hazards для повторяющихся событий. Учитывает время до каждого события, но предполагает одинаковый риск для всех событий.
		    - **Prentice–Williams–Peterson (PWP) model** (есть варианты “total time” и “gap time”) — учитывает порядок событий, позволяет моделировать риски каждого следующего события отдельно.
		    - **Wei–Lin–Weissfeld (WLW) model** — маргинальная модель, оценивает каждый “порядковый” риск как отдельный процесс.
		- **Frailty-модели** (shared frailty) — добавляют случайные эффекты для учёта неоднородности между объектами (например, разные склонности к поломкам).
		- **Multi-state модели** — рассматривают объект как находящийся в разных состояниях (“исправен”, “поломка 1”, “поломка 2” …).
	
		Модели реализованы в открытых библиотеках:
		- `lifelines` (Python) — Cox PH, AG, PWP, WLW, frailty.
		- `survival` (R), `frailtypack` (R), `mstate` (R).
	2. **Динамические признаки**: формируем ковариаты не только «на момент первого поступления», а _после каждого события_ (например, длительность предыдущей госпитализации, отделение/диагностическая группа, итоги лечения, наличие экстренной доставки и пр.). Проводим прямое сравнение «статические vs динамические» в PWP-GT.
	3. **Калибровка во времени для recurrent events**: простая, воспроизводимая процедура проверки калибровки кривых кумулятивного риска в разрезе порядков события (1-е, 2-е, 3-е).
3. Данные:
	- **MIMIC-IV**. Позволяет построить последовательности госпитализаций на пациента, вычислить интервалы до повторной госпитализации и сформировать динамические признаки.
	- Trucks from SCANIA: [source](https://researchdata.se/en/catalogue/dataset/2024-34) + [article](https://arxiv.org/html/2401.15199v1)
	- Рецидивы преступлений: https://www.kaggle.com/datasets/danofer/compass?utm_source=chatgpt.com&select=cox-violent-parsed.csv (мало значимых признаков)
	- National Hospital Discharge Survey dataset (описание https://www.johnsnowlabs.com/marketplace/initial-diagnosis-of-disease-by-age/): https://github.com/jackwasey/nhds?ysclid=mewvcirzum181775995 (GitHub)
	- Подготовка данных:
		- Отфильтровать пациентов с ≥1 повторной госпитализации.
		- Определить:
		    - id,
		    - время начала/окончания каждого эпизода,
		    - _gap time_ до следующего эпизода,
		    - индикатор события (повторная госпитализация) или цензурирования.
		- Признаки (примеры): возраст на эпизод, пол, тип поступления (экстр./план), длительность предыдущей госпитализации, отделение/DRG/диагностические группы, операции/процедуры (укрупнённо), сезонность/день недели выписки.
    
4. Исследовательские вопросы и гипотезы:
- RQ1: Улучшают ли динамические признаки (после каждого события) прогноз по сравнению со статическими (только на старте)?
- RQ2: Важно ли моделировать порядок событий (1-я, 2-я, 3-я госпитализация)?
- RQ3: Какие факторы связаны с ускорением следующей госпитализации и как это зависит от порядка события?   

5. Экспериментальное исследование:
- Разбиение: train/val/test по пациентам (не по событиям).
- Метрики для recurrent events:
    - CI для повторных событий?
    - Integrated Brier Score (time-dependent). 
- Интерпретация: вклад признаков в риск следующего события.

6. Программная реализация (артефакт)
- Python (`lifelines`, `scikit-survival`, `pandas`, `numpy`).
- **Пакет/дашборд**:
    - Загрузка и подготовка данных → конструктор панелей counting-process → обучение выбранной модели → прогноз кривой риска для _(k+1)_-й госпитализации.
    - Дашборд: интерактивные KM-кривые по порядкам, k-step предсказания, доверительные интервалы, вклады признаков.