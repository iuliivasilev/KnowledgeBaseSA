---
Title: Deep survival analysis for interpretable time-varying prediction of preeclampsia risk
Link: "[Link](https://www.sciencedirect.com/science/article/pii/S1532046424001060)"
Year: 2024
Direction:
  - "[[Time Varying]]"
  - "[[DeepLearning]]"
Code:
Type: Research
Overview:
Datasets:
Metrics:
  - "[[IBS]]"
  - CITD
  - AUCTD
  - AUC
Reviewer: dvarfe
Source: Journal of Biomedical Informatics
---
# Тема исследования
Работа посвящена интерпретируемому предсказанию риска преэклампсии у беременных. Используется time-varying подход, так как он позволяет улавливать более сложные зависимости, нежели классические методы. Для прогноза используется [[DeepHit A Deep Learning Approach to Survival Analysis With Competing Risks|DeepHit]] к выходам которого применяется time-series K-Means кластеризация, а интерпретируемость затем исследуется методом SHAP.
# Постановка задачи  
Задача состоит в том, чтобы точно предсказывать время наступления преэклампсии с учётом временной динамики, которая меняется в течение беременности. Целью работы является создание модели, которая будет способна:
1. Учитывать нелинейные и меняющиеся во времени зависимости между признаками и риском
2. Строить индивидуальные траектории риска для каждого пациента
3. Обеспечивать интерпретируемость результатов.

# Предложенное решение
1. В качестве модели, которая предсказывает риски используется DeepHit. Данная модель предназначена для прогнозирования конкурирующих рисков, но авторы статьи упрощают архитектуру до одного события(диагноза преэклампсии).
2. Для борьбы с дисбалансом применяется оверсэмплинг. Число случаев преэклампсии(6.3%) при обучении удваивалось.
3. К прогнозам модели применяется time-series K-Means на три кластера. Данный метод кластеризации является модификацией классического K-Means, который позволяет кластеризовывать временные ряды. Целью данного этапа является выявление типичных профилей динамики риска среди пациентов. Исследователи выделяют три кластера: **низкий риск**, **ранняя преэклампсия**(до 34 недель) и **поздняя преэклампсия**(риск начинает резко расти на поздних сроках или после родов). **Замечание:** модель пропорциональных рисков Кокса выдаёт параллельные линии, поэтому выявлять кластеры среди её прогнозов не имеет смысла.
4. Наконец, с помощью SHAP определяется какие признаки влияют на попадание пациента в тот или иной кластер. Для всех кластеров важнейшими признаками были **артериальное давление** и **медицинский анамнез**.

# Наборы данных  
В данные входит история наблюдений за беременными пациентами за 2015-2023 гг. Использовались только данные о пациентках более чем с 20 неделями наблюдения. Чтобы избежать утечки переменных использовались только данные, собранные до 20 недели беременности. Так как у большинства пациенток в этот срок было не более двух визитов временные ряды получались короткими и все данные агрегировались в признаки:
1. Максимальное значение
2. Минимальное
3. Среднее
4. Разница между максимальны и минимальным
5. Самое последнее значение
Также стоит отметить, что авторы подчёркивают отсутствие цензурированных данных. Это связано с конечной природой беременности, а также тем, что диагноз преэклампсия может быть поставлен не позднее, чем через 6 недель после родов.  
# Экспериментальные исследования  
**Метрики**:
1. Time-Dependent Concordance Index. $C^{td} = P\left(\widehat{F}\left(t^{(i)} \mid \mathbf{x}^{(i)}\right) > \widehat{F}\left(t^{(j)} \mid \mathbf{x}^{(j)}\right) \mid t^{(i)} < t^{(j)}\right)$. 
	В отличие от стандартного CI данная метрика оценивает способность модели корректно упорядочивать прогнозы модели **в каждый момент времени**. Для двух пациентов, где у одного событие произошло в момент t, а другой оставался под наблюдением хотя бы до момента t, модель должна присвоить более высокий риск **на момент времени t** тому, у кого событие произошло. Преимуществом такой метрики является то, что она не полагается на предположение о пропорциональности рисков.
2. Time-Dependent AUC.  $AUC_{td} = \frac{1}{N_{\text{times}}} \sum_{t=1}^{N_{\text{times}}} AUC(t)$ 
	Аналогично предыдущей метрики, AUC оценивается в каждый момент времени и усредняется.
3. IBS, AUC – стандартные метрики.

|         | CITD  | AUCTD | IBS   | AUC   |
| ------- | ----- | ----- | ----- | ----- |
| CoxPH   | 0.824 | 0.811 | 0.023 | 0.771 |
| DeepHit | 0.839 | 0.824 | 0.028 | 0.778 |
Видно, что в среднем DeepHit показывает метрики чуть лучше, чем стандартный CoxPH.

Количественная оценка качества кластеризации не производилась. Показано, что визуально кластеры имеют разные формы траекторий, а также результаты SHAP-анализа согласуются с медицинской литературой.
# Выводы  
- Модель позволяет строить **индивидуальные траектории риска** для каждой пациентки.
- Это открывает возможность для **своевременной и целевой профилактики** (например, назначение асприна до 16-й недели группам высокого риска ранней преэклампсии).
- **Раннее выявление** пациенток с высоким риском ранней преэклампсии может значительно улучшить исходы беременности.
- Предложенный  конвейер (DeepHit + временная кластеризация + SHAP) является **универсальным**.
- Он может быть применен для прогнозирования других заболеваний с сложной временной динамикой риска, не только в акушерстве, но и в других областях медицины.
# Примечания
- Любопытно, что датасет без цензуры
- Time-Varying в данной статье подразумевает отсутствие предположения о пропорциональности рисков, при этом обучается и применяется модель на одном наблюдении на item. 